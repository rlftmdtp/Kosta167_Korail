<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">



<mapper namespace="share.mapper.ShareMapper">
	<cache />
	
	<select id="selectSh_no" resultType="Integer">
		select max(sh_no) from shareText
	</select>
	
	<!-- 공유 게시판 글 등록 -->
	
	<insert id="insertShare" parameterType="Share">
		insert into shareText(
			sh_no, c_id, m_id, sh_subject, sh_title, sh_content, sh_pw, sh_date, sh_hit, sh_shareok
		)
		values(
			#{sh_no}, #{c_id} , #{m_id}, #{sh_subject}, #{sh_title}, #{sh_content},
			#{sh_pw}, SYSDATE, 0, 'Y'
		)
	
	</insert>
	
	<!-- 공유글 쓰기 폼에서 코스 디테일 불러오기 -->
	<select id="viewCourseDetail" resultType="CourseDetail" parameterType="Integer">
      select * from COURSEDETAIL
         where c_id = #{c_id}
   
   </select>
	
	<!-- 공유 목록 전체 리스트 출력 -->
	<select id="listShare" resultType="Share" parameterType="ShareSearch">
		select * from shareText
		
		<if test ="area !=null">
			<where>
				<foreach collection="area" item="item" separator="OR" open="(" close=")">
					${item} LIKE #{searchKey}
				</foreach>
			</where>
			</if>
			order by sh_no desc 
	</select>
	
	<!-- 로그인 -->
	<select resultType="Member" id="login" parameterType="Member"> 
		select * from member where m_id = #{m_id} and m_pw = #{m_pw}
	</select>
	
	<!-- 자세하게 출력 -->
	<select id="selectShare" parameterType="int" resultType="Share">
		select * from shareText where sh_no = #{sh_no}
	</select>
	
	<!-- 조회수 증가 -->
	<update id="updateShareHit" parameterType="int">
		 update shareText set sh_hit=sh_hit+1 where sh_no=#{sh_no}
	</update>
	
	<!-- 글수정 -->
	<update id="updateShare" parameterType="Share">
		update shareText set sh_title=#{sh_title}, sh_content=#{sh_content}
		where sh_no=#{sh_no}     
	</update>
	
	<!-- 글삭제  -->
	<delete id="deleteShare" parameterType="int">
		delete from shareText where sh_no = #{sh_no}
	</delete>
	
	 <!-- 페이징 처리  -->
	<select id="countBoard" resultType="int" parameterType="ShareSearch" >
		select count(*) from shareText
		<if test="area !=null">
			<where>
				<foreach collection="area" item="item" separator="OR" open="(" close=")">
					${item} LIKE #{searchKey}
				</foreach>
			
			</where>
		
		</if>
		</select>
		
	<!-- 리플 글번호 -->
	<select id="selectSr_no" resultType="Integer">
		select max(sr_no) from shareReply
	</select>
	
	<!-- 리플 글생성 -->
	<insert id="insertReply" parameterType="ShareReply">
		insert into shareReply(
		sr_no, sr_content, sr_date , sh_no
		)
		values(
		#{sr_no}, #{sr_content}, SYSDATE, #{sh_no}
		)
	</insert>
	
	<!-- 댓글 출력	 -->
	<select id="listshareReply" resultType="ShareReply" parameterType="int">
		 select * from shareReply 
		 where sh_no = #{sh_no}
		 order by sr_no desc
	</select>
		
	<!-- 댓글 삭제 -->
	<delete id="deleteReply" parameterType="int">
		delete from shareReply
		where sh_no=#{sh_no}
	
	</delete>
	

</mapper>
